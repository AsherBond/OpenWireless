#!/usr/bin/python

import os, json, sys, uci, common

environ = os.environ
params = {}

interface_dictionary = {"#Openwirelessorg": "1", "#PrivateWifi": "3"}

def wireless_is_disabled(interface_name):
    is_disabled = uci.get("wireless.@wifi-iface[" + interface_name + "].disabled") == "1"
    return is_disabled


def toggle_wireless_status(interface_name):
    if wireless_is_disabled(interface_name):
        uci.set("wireless.@wifi-iface[" + interface_name + "].disabled=0")
    else:
        uci.set("wireless.@wifi-iface[" + interface_name + "].disabled=1")
    uci.commit("wireless")

def set_error(param):
    params['error'] = 'Invalid ' + param

if environ.get('REQUEST_METHOD', 'GET').lower() == 'post':
    json_body = json.loads(sys.stdin.read())

    for k in json_body.keys():
        params[k] = json_body[k]

    set_error(interface_dictionary[params["params"]["interface_name"]])
    toggle_wireless_status(interface_dictionary[params["params"]["interface_name"]])

else:
    set_error('GET request')

print "Content-Type:application/json\r\n"
print json.JSONEncoder().encode(params)