#!/usr/bin/python

import cgi, os, json
from subprocess import check_output, call


def check_device(config_name):
  return check_output("uci get wireless." + config_name + ".device", shell=True).strip()

def check_param(device, param):
  return check_output("uci get wireless." + device + "." + param, shell=True).strip()

editable_values = ["ispDownloadSpeed", "ispUploadSpeed", "routerBand", "routerChannel", "routerChannelBandwidth", "openwirelessBand", "openwirelessChannel", "openwirelessChannelBandwidth"]

environ = os.environ

params = cgi.parse(environ.get("QUERY_STRING", "default value"))

if environ.get('REQUEST_METHOD', 'GET').lower() == 'post':
    fs = cgi.FieldStorage()
    file_read = fs.file.read()
    json_body = json.loads(file_read)

    for k in json_body.keys():
        params[k] = json_body[k]

if len(params) == 2:
    if params.get('routerBand'):
        current_band = check_device("@wifi-iface[0]")

        if current_band == "radio0":
           new_band = "radio1"
        else:
           new_band = "radio0"

    call("uci set wireless.@wifi-iface[0].device=" + new_band, shell=True)
    call("uci commit wireless", shell=True)


print "Content-Type:application/json\r\n"
print json.JSONEncoder().encode(params)